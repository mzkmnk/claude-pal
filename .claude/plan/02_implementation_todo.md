# Claude PAL 実装計画書（TODO）

## Phase 1: プロジェクト初期設定

### 環境構築
- [x] Ionic CLIのインストール確認
- [x] Node.js 20.x のインストール確認
- [x] 新規Ionicプロジェクトの作成
  - [x] `ionic start claude-pal tabs --type=angular --capacitor`
  - [x] プロジェクトディレクトリへ移動
  - [x] 初期ビルドの確認
- [ ] 必要なパッケージのインストール
  - [ ] SSH関連: `npm install ssh2 ssh2-promise node-forge`
  - [ ] ターミナル: `npm install xterm xterm-addon-fit xterm-addon-web-links`
  - [ ] セキュリティ: `npm install crypto-js`
  - [ ] UI追加: `npm install @ionic/pwa-elements`
- [x] Capacitorプラットフォームの追加
  - [x] `ionic capacitor add ios`
  - `ionic capacitor add android`(現状は未対応)
- [x] ESLint/Prettier設定
  - [x] `.eslintrc.json`の作成
  - [x] `.prettierrc`の作成
  - [x] pre-commitフックの設定

### プロジェクト構造の整備
- [ ] ディレクトリ構造の作成
  - [ ] `src/app/core`ディレクトリ作成
  - [ ] `src/app/shared`ディレクトリ作成
  - [ ] `src/app/features`ディレクトリ作成
- [ ] 環境変数ファイルの設定
  - [ ] `environment.ts`の更新
  - [ ] `environment.prod.ts`の更新
- [ ] アセットの準備
  - [ ] アプリアイコンの作成
  - [ ] スプラッシュスクリーンの作成

## Phase 2: コアサービス実装

### SSH鍵管理サービス
- [x] `key-manager.service.ts`の作成
- [x] 鍵生成機能の実装
  - [x] RSA 4096bit鍵ペアの生成
  - [x] OpenSSH形式への変換
  - [x] フィンガープリントの計算
- [x] 鍵保存機能の実装
  - [x] iOS Keychain統合
  - [ ] Android Keystore統合（対応予定なし）
  - [x] Web版のフォールバック実装
- [x] 鍵取得機能の実装
  - [x] 生体認証の統合
  - [x] エラーハンドリング
- [x] 鍵削除機能の実装
- [x] 鍵一覧取得機能の実装
- [x] 単体テストの作成

### ストレージサービス
- [x] `storage.service.ts`の作成
- [x] Capacitor Preferencesのラッパー実装
- [x] 接続プロファイルの保存/読み込み
- [x] アプリ設定の保存/読み込み
- [x] データ暗号化の実装
- [x] マイグレーション機能の実装
- [x] 単体テストの作成

### SSH接続サービス
- [ ] `ssh.service.ts`の作成
- [ ] SSH接続の確立機能
  - [ ] ssh2ライブラリの統合
  - [ ] 認証処理の実装
  - [ ] エラーハンドリング
- [ ] シェルセッションの管理
- [ ] コマンド実行機能
- [ ] データストリームの処理
- [ ] 接続状態の管理
- [ ] 自動再接続機能
- [ ] 単体テストの作成

### プロファイル管理サービス
- [ ] `profile.service.ts`の作成
- [ ] プロファイルのCRUD操作
- [ ] デフォルトプロファイルの管理
- [ ] 最近使用したプロファイルの追跡
- [ ] プロファイルのバリデーション
- [ ] 単体テストの作成

## Phase 3: UIコンポーネント実装

### デモUI実装（Tab1）
- [x] SSH鍵管理デモ画面の作成
- [x] 鍵生成フォームの実装
- [x] 鍵一覧表示の実装
- [x] 鍵詳細表示機能
- [x] 公開鍵コピー機能
- [x] 鍵削除機能（確認ダイアログ付き）

### ターミナルコンポーネント
- [ ] `terminal.component.ts`の作成
- [ ] xterm.jsの統合
  - [ ] 基本的なターミナル表示
  - [ ] テーマ設定（ダークテーマ）
  - [ ] フォント設定
- [ ] 入力処理の実装
  - [ ] キーボード入力の処理
  - [ ] 特殊キーの処理（Ctrl, Alt等）
  - [ ] コピー&ペーストの実装
- [ ] 出力処理の実装
  - [ ] ANSIエスケープシーケンスの処理
  - [ ] スクロール機能
  - [ ] 画面クリア機能
- [ ] アドオンの統合
  - [ ] fit addon（自動サイズ調整）
  - [ ] web-links addon（URLクリック）
  - [ ] search addon（検索機能）
- [ ] レスポンシブ対応
- [ ] ジェスチャー操作の実装
- [ ] 単体テストの作成

### メッセージコンポーネント
- [ ] `message.component.ts`の作成
- [ ] メッセージタイプ別の表示
  - [ ] ユーザーメッセージ
  - [ ] Claude出力
  - [ ] システムメッセージ
  - [ ] エラーメッセージ
- [ ] コードハイライト機能
- [ ] タイムスタンプ表示
- [ ] アニメーション実装
- [ ] 単体テストの作成

### SSH鍵カードコンポーネント
- [ ] `ssh-key-card.component.ts`の作成
- [ ] 鍵情報の表示
- [ ] 公開鍵のコピー機能
- [ ] 削除確認ダイアログ
- [ ] 単体テストの作成

### 接続フォームコンポーネント
- [ ] `connection-form.component.ts`の作成
- [ ] フォームバリデーション
- [ ] 入力補助機能
- [ ] エラー表示
- [ ] 単体テストの作成

## Phase 4: 画面実装

### チャット画面
- [ ] `chat.page.ts`の作成
- [ ] メッセージ一覧の表示
- [ ] 入力エリアの実装
  - [ ] 自動高さ調整
  - [ ] Shift+Enterで改行
  - [ ] Enterで送信
- [ ] コマンド履歴機能
- [ ] 入力補完機能（基本）
- [ ] スクロール制御
- [ ] 画面遷移アニメーション
- [ ] 統合テストの作成

### ターミナル画面
- [ ] `terminal.page.ts`の作成
- [ ] ターミナルコンポーネントの統合
- [ ] ツールバーの実装
  - [ ] 接続状態表示
  - [ ] クリアボタン
  - [ ] 設定ボタン
- [ ] フルスクリーンモード
- [ ] 画面回転対応
- [ ] 統合テストの作成

### SSH鍵管理画面
- [ ] `keys.page.ts`の作成
- [ ] 鍵一覧の表示
- [ ] 新規鍵生成フォーム
- [ ] 鍵詳細モーダル
- [ ] インポート機能（オプション）
- [ ] エクスポート機能
- [ ] 統合テストの作成

### 接続設定画面
- [ ] `connection.page.ts`の作成
- [ ] プロファイル一覧
- [ ] 新規接続フォーム
- [ ] プロファイル編集
- [ ] 接続テスト機能
- [ ] クイック接続
- [ ] 統合テストの作成

### 設定画面
- [ ] `settings.page.ts`の作成
- [ ] テーマ設定
- [ ] ターミナル設定
  - [ ] フォントサイズ
  - [ ] カラースキーム
  - [ ] スクロールバック行数
- [ ] セキュリティ設定
  - [ ] 生体認証の有効/無効
  - [ ] 自動ロック時間
- [ ] アプリ情報
- [ ] 統合テストの作成

## Phase 5: 高度な機能実装

### コマンドテンプレート
- [ ] テンプレート管理サービスの作成
- [ ] よく使うコマンドの保存
- [ ] カテゴリ分け機能
- [ ] テンプレート実行機能
- [ ] カスタマイズ可能な変数

### 履歴管理
- [ ] コマンド履歴の保存
- [ ] 履歴検索機能
- [ ] 履歴のクリア
- [ ] 履歴のエクスポート

### セッション管理
- [ ] 複数セッションの対応
- [ ] セッション切り替え
- [ ] バックグラウンドセッション
- [ ] セッション復元機能

### Claude Code最適化
- [ ] Claude特有のコマンド認識
- [ ] 出力のパース最適化
- [ ] コンテキスト認識
- [ ] スマート提案機能

## Phase 6: ポリッシュと最適化

### パフォーマンス最適化
- [ ] レイジーローディングの実装
- [ ] 画像最適化
- [ ] バンドルサイズの削減
- [ ] メモリリークの確認と修正
- [ ] 起動時間の最適化

### UI/UXの改善
- [ ] アニメーションの追加
- [ ] ローディング表示
- [ ] エラー表示の改善
- [ ] ダークモードの完全対応
- [ ] アクセシビリティ対応

### セキュリティ強化
- [ ] 入力のサニタイゼーション
- [ ] XSS対策
- [ ] セキュアストレージの検証
- [ ] 通信の暗号化確認

## Phase 7: テストとドキュメント

### E2Eテスト
- [ ] 主要フローのE2Eテスト作成
- [ ] デバイス別テスト
- [ ] エラーケースのテスト

### ドキュメント作成
- [ ] README.mdの作成
- [ ] セットアップガイド
- [ ] ユーザーマニュアル
- [ ] トラブルシューティングガイド
- [ ] API仕様書（内部用）

### リリース準備
- [ ] App Store用のスクリーンショット作成
- [ ] Google Play用のスクリーンショット作成
- [ ] プライバシーポリシーの作成
- [ ] 利用規約の作成
- [ ] アプリ説明文の作成

## Phase 8: デプロイと公開

### ビルドと署名
- [ ] iOS用のProvisioning Profile設定
- [ ] Android用の署名設定
- [ ] 本番ビルドの作成
- [ ] ビルドの検証

### ストア申請
- [ ] App Store Connect設定
- [ ] Google Play Console設定
- [ ] メタデータの入力
- [ ] 審査提出

### CI/CD設定（オプション）
- [ ] GitHub Actions設定
- [ ] 自動ビルドの設定
- [ ] 自動テストの設定


## 優先度

1. **必須機能**（Phase 1-4）: 基本的なSSH接続とUI
2. **重要機能**（Phase 5）: Claude Code用の最適化
3. **改善機能**（Phase 6-7）: 品質向上
4. **リリース**（Phase 8）: ストア公開